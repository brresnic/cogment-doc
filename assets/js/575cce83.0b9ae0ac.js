"use strict";(self.webpackChunkcogment_doc=self.webpackChunkcogment_doc||[]).push([[532],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),m=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=m(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=m(n),u=r,h=p["".concat(c,".").concat(u)]||p[u]||d[u]||o;return n?a.createElement(h,s(s({ref:t},l),{},{components:n})):a.createElement(h,s({ref:t},l))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var m=2;m<o;m++)s[m]=n[m];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9689:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return m},toc:function(){return l},default:function(){return p}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),s=["components"],i={sidebar_position:4},c="Metrics and Dashboard",m={unversionedId:"cogment-components/dashboard",id:"cogment-components/dashboard",title:"Metrics and Dashboard",description:"Repository Latest cogment-dashboard Release Latest cogment-metrics Release",source:"@site/docs/cogment-components/dashboard.md",sourceDirName:"cogment-components",slug:"/cogment-components/dashboard",permalink:"/docs/cogment-components/dashboard",tags:[],version:"current",lastUpdatedAt:1645720139,formattedLastUpdatedAt:"2/24/2022",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"docSidebar",previous:{title:"Trial Datastore",permalink:"/docs/cogment-components/trial-datastore"},next:{title:"Apache License",permalink:"/docs/license"}},l=[{value:"Usage",id:"usage",children:[],level:2},{value:"Setup",id:"setup",children:[{value:"Setup services in <code>docker-compose.yaml</code>",id:"setup-services-in-docker-composeyaml",children:[{value:"Metrics",id:"metrics",children:[],level:4},{value:"Dashboard",id:"dashboard",children:[],level:4}],level:3},{value:"Launch containers in <code>cogment.yaml</code>",id:"launch-containers-in-cogmentyaml",children:[],level:3},{value:"Configure Prometheus in <code>metrics/prometheus.yml</code>",id:"configure-prometheus-in-metricsprometheusyml",children:[],level:3}],level:2},{value:"Recipes",id:"recipes",children:[{value:"Retrieving services from a new service",id:"retrieving-services-from-a-new-service",children:[],level:3},{value:"Monitoring personalized metrics",id:"monitoring-personalized-metrics",children:[],level:3}],level:2},{value:"Using a custom registry",id:"using-a-custom-registry",children:[],level:2}],d={toc:l};function p(e){var t=e.components,i=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"metrics-and-dashboard"},"Metrics and Dashboard"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-dashboard"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/badge/repository-cogment%2Fcogment--dashboard-%23ffb400?style=flat-square&logo=github",alt:"Repository"}))," ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/cogment/dashboard"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/docker/v/cogment/dashboard?label=cogment-dashboard%20docker%20release&sort=semver&style=flat-square",alt:"Latest cogment-dashboard Release"}))," ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/cogment/metrics"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/docker/v/cogment/metrics?label=cogment-metrics%20docker%20release&sort=semver&style=flat-square",alt:"Latest cogment-metrics Release"}))),(0,o.kt)("p",null,"Cogment provides two services ",(0,o.kt)("strong",{parentName:"p"},"out-of-the-box")," dedicated to the monitoring of a Cogment deployment: ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment-metrics")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment-dashboard"),"."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cogment-metrics")," is gathering data coming from all the Cogment services: orchestrator, actors, environment, etc. These ",(0,o.kt)("em",{parentName:"p"},"metrics")," can be used to gather insights regarding the performance of actor or environment implementations. They can also be used to follow the attribution of rewards, giving insight into how, or even if agents are learning."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cogment-metrics")," is a ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/"},"Prometheus")," instance, so it can be easily augmented to visualize your own data."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cogment-dashboard")," is used to explore the metrics data in a human-friendly way, using graphs. Some default dashboards are available, but users can create their own dashboards, as well as use their own ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/"},"Prometheus")," requests to create their own graphs. ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment-dashboard")," is based on ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/"},"Grafana"),"."),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"After initializing your project using ",(0,o.kt)("a",{parentName:"p",href:"/docs/cogment/tutorial/bootstrap-and-data-structures"},(0,o.kt)("inlineCode",{parentName:"a"},"cogment init")),", you should already have everything setup for a standard usage. For a fully manual setup refer to the dedicated ",(0,o.kt)("a",{parentName:"p",href:"#setup"},"section"),"."))),(0,o.kt)("p",null,"In an up-and-running Cogment deployment running on your local machine, the dashboard is accessible at ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:3003/"},"http://localhost:3003/")),(0,o.kt)("p",null,"The dashboard welcomes you with a screen giving you direct access to the default sub-dashboards."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Cogment Dashboard - Welcome Screen",src:n(6462).Z,width:"3224",height:"2090"})),(0,o.kt)("p",null,"For example, the agent performances sub-dashboard gives you an idea of how long it takes for actors to handle a new set of observations as well as the number of created instances for each actor implementation. Here's an example taken after a few minutes running ",(0,o.kt)("a",{parentName:"p",href:"/docs/cogment/tutorial/dqn-player"},"tutorial #7"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Cogment Dashboard - Agent Performances",src:n(8332).Z,width:"3224",height:"2090"})),(0,o.kt)("p",null,"A similar sub-dashboard is available for environment performances."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Cogment Dashboard - Environment Performances",src:n(6081).Z,width:"3224",height:"2090"})),(0,o.kt)("p",null,"Another useful sub-dashboard pertains to the rewards. This enables you to follow the progress of the different actor implementations during training. Here's another example taken after a few minutes running ",(0,o.kt)("a",{parentName:"p",href:"/docs/cogment/tutorial/dqn-player"},"tutorial #7"),", the DQN agent is about to surpass the heuristic baseline."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Cogment Dashboard - Rewards",src:n(9473).Z,width:"3224",height:"2090"})),(0,o.kt)("p",null,"For specific use case based guides, check out the ",(0,o.kt)("a",{parentName:"p",href:"#recipes"},"recipes section"),"."),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("p",null,"To setup dashboard and metrics on a docker-based Cogment deployment only two files need to be modified and a third file needs to be created:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yaml")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"cogment.yaml")),(0,o.kt)("li",{parentName:"ul"},"Add a ",(0,o.kt)("inlineCode",{parentName:"li"},"metrics/prometheus.yml"))),(0,o.kt)("h3",{id:"setup-services-in-docker-composeyaml"},"Setup services in ",(0,o.kt)("inlineCode",{parentName:"h3"},"docker-compose.yaml")),(0,o.kt)("h4",{id:"metrics"},"Metrics"),(0,o.kt)("p",null,"Create a service named ",(0,o.kt)("inlineCode",{parentName:"p"},"metrics")," using the ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment/metrics")," docker image. Log level is decreased to avoid too much verbosity, the yml file is provided in a mounted volume and another one is provided for Prometheus to store its data."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"metrics:\n    user: 0:0\n    image: cogment/metrics:latest\n    command: --config.file=/etc/prometheus/prometheus.yml --log.level=error\n    volumes:\n        - ./metrics/prometheus.yml:/etc/prometheus/prometheus.yml:ro\n        - ./metrics/data:/prometheus\n")),(0,o.kt)("p",null,"::: caution\nIt is recommended to use a fixed version of ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment/metrics"),", refer to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-dashboard"},"https://github.com/cogment/cogment-dashboard")," to get its version number.\n:::"),(0,o.kt)("h4",{id:"dashboard"},"Dashboard"),(0,o.kt)("p",null,"Create a service named ",(0,o.kt)("inlineCode",{parentName:"p"},"dashboard")," and pick an exposed port to consult."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"dashboard:\n    image: cogment/dashboard:latest\n    ports:\n        - 3003:3000/tcp\n    depends_on:\n        - metrics\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"It is recommended to use a fixed version of ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment/dashboard"),", refer to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cogment/cogment-dashboard"},"https://github.com/cogment/cogment-dashboard")," to get its version number."))),(0,o.kt)("h3",{id:"launch-containers-in-cogmentyaml"},"Launch containers in ",(0,o.kt)("inlineCode",{parentName:"h3"},"cogment.yaml")),(0,o.kt)("p",null,"It is recommended to start and stop ",(0,o.kt)("inlineCode",{parentName:"p"},"dashboard")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"metrics")," alongside the other services of the Cogment deployment. The easiest way to do that is to add ",(0,o.kt)("inlineCode",{parentName:"p"},"dashboard metrics")," to the start and stop commands in your ",(0,o.kt)("inlineCode",{parentName:"p"},"cogment.yaml")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"start: docker-compose up dashboard metrics orchestrator environment [...]\nstop: docker-compose stop dashboard metrics orchestrator environment [...]\n")),(0,o.kt)("h3",{id:"configure-prometheus-in-metricsprometheusyml"},"Configure Prometheus in ",(0,o.kt)("inlineCode",{parentName:"h3"},"metrics/prometheus.yml")),(0,o.kt)("p",null,"Prometheus will collect data from various services, from the environment and the actors. All those data will be stored in ",(0,o.kt)("inlineCode",{parentName:"p"},"./metrics/data"),". More information about how Prometheus can store data is available ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/prometheus/latest/storage/"},"here"),"."),(0,o.kt)("p",null,"Inside ",(0,o.kt)("inlineCode",{parentName:"p"},"metrics/prometheus.yml"),", each service that will be monitored should be added like below. In the following example the environment service is the only one that will be collecting data."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'global:\n    scrape_interval: 5s # Set the scrape interval to every 5 seconds. Default is every 1 minute.\n    evaluation_interval: 5s # Evaluate rules every 5 seconds. The default is every 1 minute.\n\n# A scrape configuration containing exactly one endpoint to scrape:\nscrape_configs:\n    # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n    - job_name: "environment"\n      dns_sd_configs:\n          - names:\n                - "environment" # Hostname of the environment service (from ./docker-compose.yaml)\n            type: "A"\n            port: 8000\n            refresh_interval: 5s\n')),(0,o.kt)("h2",{id:"recipes"},"Recipes"),(0,o.kt)("h3",{id:"retrieving-services-from-a-new-service"},"Retrieving services from a new service"),(0,o.kt)("p",null,"To add other services from which to collect data, simply add other ",(0,o.kt)("inlineCode",{parentName:"p"},"scrape_configs"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'scrape_configs:\n    # Here you should have existing configuration for other services.\n    # Here add a new service that will be monitored\n    - job_name: "new_service"\n      dns_sd_configs:\n          - names:\n                - "new_service" # Hostname of the service as defined in ./docker-compose.yaml\n            type: "A"\n            port: 8000 # Port on which the prometheus agent is running, Cogment SDKs uses 8000 by default\n            refresh_interval: 5s\n')),(0,o.kt)("p",null,"More information can be found in the ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/prometheus/latest/getting_started/"},"Prometheus documentation")),(0,o.kt)("h3",{id:"monitoring-personalized-metrics"},"Monitoring personalized metrics"),(0,o.kt)("p",null,"You can add your own metrics in your code by using the Prometheus API. Added metrics will be ",(0,o.kt)("em",{parentName:"p"},"automagically")," discovered by the Prometheus agent that is started by the Cogment SDKs."),(0,o.kt)("p",null,"Here's how it looks in python."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from prometheus_client import Summary, Counter\n\nMY_SUMMARY = Summary('my_func', 'Time spent')\nMY_COUNTER = Counter('metrics_to_count', 'The stuff I want to count')\n\n#[...]\n\n@MY_SUMMARY.time() # Will automatically measure the time spent\ndef my_func()\n    MY_COUNTER.inc()\n")),(0,o.kt)("p",null,"Several types of metrics are available in Prometheus. Consult the prometheus ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/concepts/metric_types/"},"documentation")," for futher reference."),(0,o.kt)("h2",{id:"using-a-custom-registry"},"Using a custom registry"),(0,o.kt)("p",null,"By default, Cogment SDKs rely on the default Prometheus global registry. To change the used registry, it needs to be given to the context when built."),(0,o.kt)("p",null,"Here's how it looks in python."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import cog_settings\n\nimport cogment\nimport prometheus_client\n\n# [...]\n\nregistry = prometheus_client.CollectorRegistry()\ncontext = cogment.Context(cog_settings=cog_settings, user_id="my_user_id", prometheus_registry=registry)\n')),(0,o.kt)("p",null,"It is also possible to completely deactivate the gathering of the Prometheus metrics by setting ",(0,o.kt)("inlineCode",{parentName:"p"},"prometheus_registry")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"None"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'context = cogment.Context(cog_settings=cog_settings, user_id="my_user_id", prometheus_registry=None)\n')))}p.isMDXComponent=!0},8332:function(e,t,n){t.Z=n.p+"assets/images/cogment-dashboard-agent-performances-8b6c6ce60db573a196176b22241a2232.png"},6081:function(e,t,n){t.Z=n.p+"assets/images/cogment-dashboard-environment-performances-99623c49bde2954a7cf76cd0cb0e5dc4.png"},9473:function(e,t,n){t.Z=n.p+"assets/images/cogment-dashboard-rewards-8c3320c66a4c7f6359476e2e1b7b9f7b.png"},6462:function(e,t,n){t.Z=n.p+"assets/images/cogment-dashboard-welcome-9dbf56ec6f2402a15687f2722df5637a.png"}}]);